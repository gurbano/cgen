!function e(t,r,o){function n(s,a){if(!r[s]){if(!t[s]){var p="function"==typeof require&&require;if(!a&&p)return p(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){var r=t[s][1][e];return n(r?r:e)},u,u.exports,e,t,r,o)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)n(o[s]);return n}({"/home/gurbano/workspace/snippets/cgen/app/scripts/app/cgen.js":[function(e,t,r){"use strict";function o(e,t){var r=new Date(e);return r.setDate(r.getDate()+t),r}var n=e("./modules/WorldLoader"),i=e("./modules/UserStore"),s=["left","right","up","down"],a={VIEW_ANGLE:45,NEAR:.1,FAR:1e6},p=(THREE.Vector3(1,0,0),THREE.Vector3(0,0,0),function(e,t){var r=this;s.forEach(function(e){r.S.keys[e]=r.keyboard.pressed(e)})}),c=function(e,t){if(this.world&&this.world.intersect){var r=this.world.get("light");r.position.x=this.world.intersect.x,r.position.y=this.world.intersect.y,r.position.z=this.world.intersect.z}},u=new Date,h=function(e,t){if(this.world){var r=this.world.get("earth");r.cloudsMesh.rotation.y+=1/80*e,u=o(u,1)}},l=function(e){this.targetId=e.target,this.target=$("#"+e.target),this.PG={},this.PG.store=new i(e.userId),this.PG.entity=this.PG.store.get(),this.updateFcts=[],this.updateFcts.push(c),this.updateFcts.push(p),this.updateFcts.push(h),this.S={},this.S.keys={},this.S.scene=void 0,this.S.renderer=void 0};l.prototype.hello=function(e){return console.info("Hello "+this.PG.entity.userName),this},l.prototype.initHardware=function(e){return a.WIDTH=this.target.width(),a.HEIGHT=this.target.height(),a.ASPECT=a.WIDTH/a.HEIGHT,console.info("Application initialized",a.WIDTH,a.HEIGHT),this.keyboard=new THREEx.KeyboardState,this.S.scene=new THREE.Scene,this.S.camera=new THREE.PerspectiveCamera(a.VIEW_ANGLE,a.ASPECT,a.NEAR,a.FAR),this.S.renderer=new THREE.WebGLRenderer,this.S.renderer.setSize(a.WIDTH,a.HEIGHT),this.S.renderer.gammaInput=!0,this.S.renderer.gammaOutput=!0,this.S.controls=new THREE.OrbitControls(this.S.camera,this.S.renderer.domElement),this.S.controls.minPolarAngle=1,this.S.controls.maxPolarAngle=1.7,this.S.controls.minDistance=15e3,this.S.controls.maxDistance=25e3,this.S.controls.addEventListener("change",function(){}),this.S.scene.add(this.S.camera),this.target.append(this.S.renderer.domElement),this},l.prototype.initWorld=function(e){return this.world=new n(this).init(),this.S.scene.add(this.world.getRoot()),this},l.prototype.start=function(){return console.info("Application started"),this.S.camera.position.x=this.PG.entity.position.x,this.S.camera.position.y=this.PG.entity.position.y+5e3,this.S.camera.position.z=this.PG.entity.position.z,this.loop(),this},l.prototype.queryControls=function(e){return this.S.keys[e]},l.prototype.loop=function(){function e(o){requestAnimationFrame(e.bind(t)),r=r||o-1e3/60;var n=Math.min(200,o-r);r=o,t.S.controls.update(n/1e3),t.updateFcts.forEach(function(e){e.bind(t)(n/1e3,o/1e3)}),t.S.renderer.render(t.S.scene,t.S.camera)}var t=this,r=null;requestAnimationFrame(e.bind(t))},t.exports=l},{"./modules/UserStore":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/UserStore.js","./modules/WorldLoader":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/WorldLoader.js"}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/dep/ImprovedNoise.js":[function(e,t,r){"use strict";var o=function(){function e(e){return e*e*e*(e*(6*e-15)+10)}function t(e,t,r){return t+e*(r-t)}function r(e,t,r,o){var n=15&e,i=8>n?t:r,s=4>n?r:12==n||14==n?t:o;return(0==(1&n)?i:-i)+(0==(2&n)?s:-s)}for(var o=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],n=0;256>n;n++)o[256+n]=o[n];return{noise:function(n,i,s){var a=~~n,p=~~i,c=~~s,u=255&a,h=255&p,l=255&c;n-=a,i-=p,s-=c;var d=n-1,m=i-1,f=s-1,g=e(n),E=e(i),y=e(s),v=o[u]+h,w=o[v]+l,T=o[v+1]+l,S=o[u+1]+h,M=o[S]+l,R=o[S+1]+l;return t(y,t(E,t(g,r(o[w],n,i,s),r(o[M],d,i,s)),t(g,r(o[T],n,m,s),r(o[R],d,m,s))),t(E,t(g,r(o[w+1],n,i,f),r(o[M+1],d,i,s-1)),t(g,r(o[T+1],n,m,f),r(o[R+1],d,m,f))))}}};t.exports=o},{}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/helper.js":[function(e,t,r){"use strict";function o(){return this instanceof o?(this.DATE_FORMAT="dd MM hh:ii",this.FB_DATE="dd/mm/yyyy hh:ii",this):new o}o.prototype.dateToString=function(e){return $.formatDateTime(this.DATE_FORMAT,e)},o.prototype.toFbDate=function(e){return e.getTime()},o.prototype.msToString=function(e){return $.formatDateTime(this.DATE_FORMAT,new Date(e))},o.prototype.stringToDate=function(e){return new Date(e)},o.prototype.deepCopy=function(e){return $.extend(!0,{},e)},o.prototype.shallowCopy=function(e){return $.extend({},e)},o.prototype.random=function(e,t){return Math.random()*(t-e)+e},o.prototype.randomInt=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},o.prototype.extend=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},o.prototype.distance=function(e,t){try{return google.maps.geometry.spherical.computeDistanceBetween(e,t)}catch(r){return 0}},o.prototype.speedMS=function(e,t,r){var o=google.maps.geometry.spherical.computeDistanceBetween(e,t),n=o/(1e3*r);return n},o.prototype.speedKmH=function(e,t,r){var o=60*this.speedMS(e,t,r)*60/1e3;return o},o.prototype.interpolate=function(e,t,r,o,n){var i=o+(n-o)*(e-t)/(r-t);return i},o.prototype.dayOfTheYear=function(e){var t=new Date(e);return t.setMonth(0,0),Math.round((e-t)/864e5)},o.prototype.getUID=function(){return"#"+(new Date).getTime()},t.exports=new o},{}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/UserStore.js":[function(e,t,r){"use strict";var o={x:100,y:500,z:100},n=function(e){this.userId=e};n.prototype.get=function(){return{position:o,userId:this.userId,userName:"gurbano",update:function(e,t,r){}}},n.prototype.set=function(e){o.x=e.position.x,o.y=e.position.y,o.z=e.position.z},t.exports=n},{}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/WorldLoader.js":[function(e,t,r){"use strict";function o(){var e=new THREE.CylinderGeometry(0,20,100,3);return e.translate(0,50,0),e.rotateX(Math.PI/2),new THREE.Mesh(e,new THREE.MeshNormalMaterial)}function n(){var e=new THREE.DirectionalLight(16777215,.6);return e.position.set(5e3,0,5e3),e}function i(e,t){var r=new THREE.AxisHelper(500),o=a(e,t);return r.position.set(o.x,o.y,o.z),r}function s(){return p.getEarth()}function a(e,t){var r=5e3,o=(90-e)*(Math.PI/180),n=(t+180)*(Math.PI/180),i=-(r*Math.sin(o)*Math.cos(n)),s=r*Math.sin(o)*Math.sin(n),a=r*Math.cos(o);return new THREE.Vector3(i,a,s)}var p=(e("../dep/ImprovedNoise"),e("./factories/PlanetFactory")),c=e("../helper"),u=function(e){this.parent=e};u.prototype.init=function(e){return new h(this.parent)};var h=function(e){var t=new THREE.Object3D;this.getRoot=function(){return t},this.id="world0",this.interceptor={raycaster:new THREE.Raycaster,mouse:new THREE.Vector2,renderer:e.S.renderer,camera:e.S.camera},this.raycaster={raycaster:new THREE.Raycaster,start:new THREE.Vector2,renderer:e.S.renderer,camera:e.S.camera},this.entities={},this.add("light",n()),this.add("helper",o()),this.add("axisHelper",new THREE.AxisHelper(5e3)),this.add("earth",s()),this.add("rome",i(41.890251,12.492373)),document.addEventListener("mousemove",l.bind(this),!1)};h.prototype.add=function(e,t){this.entities[e]=t,this.getRoot().add(t)},h.prototype.get=function(e){return this.entities[e]},h.prototype.setSunPosition=function(e){if(this.get("light")){for(var t=new Date(e),r=c.dayOfTheYear(t),o=(r-91+365)%365,n=1800,i=[{limit:[0,91],angle:[0,n],id:"A"},{limit:[92,172],angle:[n,0],id:"B"},{limit:[173,266],angle:[0,-n],id:"C"},{limit:[266,365],angle:[-n,0],id:"D"}],s=0,a=0;a<i.length;a++){var p=i[a].limit,u=i[a].angle;if(o>=p[0]&&o<p[1]){s=c.interpolate(o+t.getHours()/24,p[0],p[1],u[0],u[1]),console.info(i[a].id,r,o,s.toFixed(0));break}}var h=15*-((e/36e5+6)%24),l=s;this.get("light").position.set(5e3*Math.sin(h*Math.PI/180),l,5e3*Math.cos(h*Math.PI/180)),this.get("light").lookAt(0,0,0)}},t.exports=u;var l=function(e){this.interceptor.mouse.x=e.clientX/this.interceptor.renderer.domElement.clientWidth*2-1,this.interceptor.mouse.y=2*-(e.clientY/this.interceptor.renderer.domElement.clientHeight)+1,this.interceptor.raycaster.setFromCamera(this.interceptor.mouse,this.interceptor.camera);var t=this.interceptor.raycaster.intersectObject(this.get("earth"));t.length>0?this.intersect={x:t[0].point.x,y:t[0].point.y,z:t[0].point.z,obj:t[0]}:this.intersect=void 0};THREE.ShaderTypes={phongDiffuse:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(16777215)},uMaterialColor:{type:"c",value:new THREE.Color(16777215)},uKd:{type:"f",value:.7},uBorder:{type:"f",value:.4}},vertexShader:["varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","}"].join("\n"),fragmentShader:["uniform vec3 uMaterialColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform float uKd;","uniform float uBorder;","varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","vec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 normal = normalize( vNormal );","float diffuse = dot( normal, lVector );","if ( diffuse > 0.6 ) { diffuse = 1.0; }","else if ( diffuse > -0.2 ) { diffuse = 0.7; }","else { diffuse = 0.3; }","gl_FragColor = vec4( uKd * uMaterialColor * uDirLightColor * diffuse, 1.0 );","}"].join("\n")}}},{"../dep/ImprovedNoise":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/dep/ImprovedNoise.js","../helper":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/helper.js","./factories/PlanetFactory":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/factories/PlanetFactory.js"}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/factories/MaterialFactory.js":[function(e,t,r){"use strict";var o=function(){};o.prototype.getTestMaterial=function(){return new THREE.MeshPhongMaterial({wireframe:!0})},o.prototype.getCloudsMaterial=function(e){var t=new THREE.MeshPhongMaterial({map:e,side:THREE.DoubleSide,opacity:.4,transparent:!0,depthWrite:!1});return t},t.exports=new o},{}],"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/factories/PlanetFactory.js":[function(e,t,r){"use strict";var o=e("./MaterialFactory"),n={EARTH:{RADIUS:5e3,BASE_COLOR:554433,BASE_FOLDER:"images/EARTH/",BUMP_SCALE:50,CLOUDS:!0}},i=function(){};i.prototype.getPlanetGeometry=function(e){return new THREE.SphereGeometry(e.RADIUS,32,32)},i.prototype.getPlanetMaterial=function(e,t){var r=new THREE.MeshPhongMaterial;return r.map=THREE.ImageUtils.loadTexture(e.BASE_FOLDER+(t||"1k")+"/texture.jpg"),r.bumpMap=THREE.ImageUtils.loadTexture(e.BASE_FOLDER+(t||"1k")+"/bump.jpg"),r.bumpScale=e.BUMP_SCALE,r.specularMap=THREE.ImageUtils.loadTexture(e.BASE_FOLDER+(t||"1k")+"/specular.jpg"),r.specular=new THREE.Color("grey"),r},i.prototype.getPlanetMesh=function(e,t){var r=new THREE.Mesh(e,t);return r},i.prototype.getEarth=function(){return this.getPlanet("EARTH")},i.prototype.getPlanet=function(e){var t=this.getPlanetGeometry(n[e]),r=this.getPlanetMaterial(n[e],"4k"),i=this.getPlanetMesh(t,r);if(i.castShadow=!0,i.receiveShadow=!0,n[e].CLOUDS){var s=new THREE.SphereGeometry(n[e].RADIUS+180,32,32),a=o.getCloudsMaterial(THREE.ImageUtils.loadTexture(n[e].BASE_FOLDER+"clouds/clouds_t.jpg"));i.cloudsMesh=new THREE.Mesh(s,a),i.add(i.cloudsMesh)}return i},t.exports=new i},{"./MaterialFactory":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/modules/factories/MaterialFactory.js"}],"/home/gurbano/workspace/snippets/cgen/app/scripts/main.js":[function(e,t,r){"use strict";var o=e("./app/cgen");$(document).ready(function(){var e=new o({target:"three-canvas",userId:"oath01",userName:"gurbano"});e.hello().initHardware({}).initWorld({}).start()})},{"./app/cgen":"/home/gurbano/workspace/snippets/cgen/app/scripts/app/cgen.js"}]},{},["/home/gurbano/workspace/snippets/cgen/app/scripts/main.js"]);