!function t(e,r,i){function o(s,a){if(!r[s]){if(!e[s]){var p="function"==typeof require&&require;if(!a&&p)return p(s,!0);if(n)return n(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[s]={exports:{}};e[s][0].call(u.exports,function(t){var r=e[s][1][t];return o(r?r:t)},u,u.exports,t,e,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\cgen.js":[function(t,e,r){"use strict";function i(t,e){var r=new Date(t);return r.setDate(r.getDate()+e),r}var o=t("./modules/WorldLoader"),n=t("./modules/UserStore"),s=["left","right","up","down"],a={VIEW_ANGLE:45,NEAR:.1,FAR:1e6},p=(THREE.Vector3(1,0,0),THREE.Vector3(0,0,0),function(t,e){var r=this;s.forEach(function(t){r.S.keys[t]=r.keyboard.pressed(t)})}),c=function(t,e){if(this.world&&this.world.intersect){var r=this.world.get("light");r.position.x=this.world.intersect.x,r.position.y=this.world.intersect.y,r.position.z=this.world.intersect.z}},u=new Date,h=function(t,e){if(this.world){var r=this.world.get("earth");r.cloudsMesh.rotation.y+=1/80*t,u=i(u,1)}},l=function(t){this.targetId=t.target,this.target=$("#"+t.target),this.PG={},this.PG.store=new n(t.userId),this.PG.entity=this.PG.store.get(),this.updateFcts=[],this.updateFcts.push(c),this.updateFcts.push(p),this.updateFcts.push(h),this.S={},this.S.keys={},this.S.scene=void 0,this.S.renderer=void 0};l.prototype.hello=function(t){return console.info("Hello "+this.PG.entity.userName),this},l.prototype.initHardware=function(t){return a.WIDTH=this.target.width(),a.HEIGHT=this.target.height(),a.ASPECT=a.WIDTH/a.HEIGHT,console.info("Application initialized",a.WIDTH,a.HEIGHT),this.keyboard=new THREEx.KeyboardState,this.S.scene=new THREE.Scene,this.S.camera=new THREE.PerspectiveCamera(a.VIEW_ANGLE,a.ASPECT,a.NEAR,a.FAR),this.S.renderer=new THREE.WebGLRenderer,this.S.renderer.setSize(a.WIDTH,a.HEIGHT),this.S.renderer.gammaInput=!0,this.S.renderer.gammaOutput=!0,this.S.controls=new THREE.OrbitControls(this.S.camera,this.S.renderer.domElement),this.S.controls.minPolarAngle=1,this.S.controls.maxPolarAngle=1.7,this.S.controls.minDistance=15e3,this.S.controls.maxDistance=25e3,this.S.controls.addEventListener("change",function(){}),this.S.scene.add(this.S.camera),this.target.append(this.S.renderer.domElement),this},l.prototype.initWorld=function(t){return this.world=new o(this).init(),this.S.scene.add(this.world.getRoot()),this},l.prototype.start=function(){return console.info("Application started"),this.S.camera.position.x=this.PG.entity.position.x,this.S.camera.position.y=this.PG.entity.position.y+5e3,this.S.camera.position.z=this.PG.entity.position.z,this.loop(),this},l.prototype.queryControls=function(t){return this.S.keys[t]},l.prototype.loop=function(){function t(i){requestAnimationFrame(t.bind(e)),r=r||i-1e3/60;var o=Math.min(200,i-r);r=i,e.S.controls.update(o/1e3),e.updateFcts.forEach(function(t){t.bind(e)(o/1e3,i/1e3)}),e.S.renderer.render(e.S.scene,e.S.camera)}var e=this,r=null;requestAnimationFrame(t.bind(e))},e.exports=l},{"./modules/UserStore":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\UserStore.js","./modules/WorldLoader":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\WorldLoader.js"}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\dep\\ImprovedNoise.js":[function(t,e,r){"use strict";var i=function(){function t(t){return t*t*t*(t*(6*t-15)+10)}function e(t,e,r){return e+t*(r-e)}function r(t,e,r,i){var o=15&t,n=8>o?e:r,s=4>o?r:12==o||14==o?e:i;return(0==(1&o)?n:-n)+(0==(2&o)?s:-s)}for(var i=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],o=0;256>o;o++)i[256+o]=i[o];return{noise:function(o,n,s){var a=~~o,p=~~n,c=~~s,u=255&a,h=255&p,l=255&c;o-=a,n-=p,s-=c;var d=o-1,f=n-1,g=s-1,m=t(o),E=t(n),y=t(s),v=i[u]+h,w=i[v]+l,T=i[v+1]+l,S=i[u+1]+h,M=i[S]+l,R=i[S+1]+l;return e(y,e(E,e(m,r(i[w],o,n,s),r(i[M],d,n,s)),e(m,r(i[T],o,f,s),r(i[R],d,f,s))),e(E,e(m,r(i[w+1],o,n,g),r(i[M+1],d,n,s-1)),e(m,r(i[T+1],o,f,g),r(i[R+1],d,f,g))))}}};e.exports=i},{}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\helper.js":[function(t,e,r){"use strict";function i(){return this instanceof i?(this.DATE_FORMAT="dd MM hh:ii",this.FB_DATE="dd/mm/yyyy hh:ii",this):new i}i.prototype.dateToString=function(t){return $.formatDateTime(this.DATE_FORMAT,t)},i.prototype.toFbDate=function(t){return t.getTime()},i.prototype.msToString=function(t){return $.formatDateTime(this.DATE_FORMAT,new Date(t))},i.prototype.stringToDate=function(t){return new Date(t)},i.prototype.deepCopy=function(t){return $.extend(!0,{},t)},i.prototype.shallowCopy=function(t){return $.extend({},t)},i.prototype.random=function(t,e){return Math.random()*(e-t)+t},i.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t+1))+t},i.prototype.extend=function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},i.prototype.distance=function(t,e){try{return google.maps.geometry.spherical.computeDistanceBetween(t,e)}catch(r){return 0}},i.prototype.speedMS=function(t,e,r){var i=google.maps.geometry.spherical.computeDistanceBetween(t,e),o=i/(1e3*r);return o},i.prototype.speedKmH=function(t,e,r){var i=60*this.speedMS(t,e,r)*60/1e3;return i},i.prototype.interpolate=function(t,e,r,i,o){var n=i+(o-i)*(t-e)/(r-e);return n},i.prototype.dayOfTheYear=function(t){var e=new Date(t);return e.setMonth(0,0),Math.round((t-e)/864e5)},i.prototype.getUID=function(){return"#"+(new Date).getTime()},e.exports=new i},{}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\UserStore.js":[function(t,e,r){"use strict";var i={x:100,y:500,z:100},o=function(t){this.userId=t};o.prototype.get=function(){return{position:i,userId:this.userId,userName:"gurbano",update:function(t,e,r){}}},o.prototype.set=function(t){i.x=t.position.x,i.y=t.position.y,i.z=t.position.z},e.exports=o},{}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\WorldLoader.js":[function(t,e,r){"use strict";function i(){var t=new THREE.CylinderGeometry(0,20,100,3);return t.translate(0,50,0),t.rotateX(Math.PI/2),new THREE.Mesh(t,new THREE.MeshNormalMaterial)}function o(){var t=new THREE.DirectionalLight(16777215,1);return t.position.set(5e3,0,5e3),t}function n(t,e){var r=new THREE.AxisHelper(500),i=a(t,e);return r.position.set(i.x,i.y,i.z),r}function s(){return p.getEarth()}function a(t,e){var r=5e3,i=(90-t)*(Math.PI/180),o=(e+180)*(Math.PI/180),n=-(r*Math.sin(i)*Math.cos(o)),s=r*Math.sin(i)*Math.sin(o),a=r*Math.cos(i);return new THREE.Vector3(n,a,s)}var p=(t("../dep/ImprovedNoise"),t("./factories/PlanetFactory")),c=t("../helper"),u=function(t){this.parent=t};u.prototype.init=function(t){return new h(this.parent)};var h=function(t){var e=new THREE.Object3D;this.getRoot=function(){return e},this.id="world0",this.interceptor={raycaster:new THREE.Raycaster,mouse:new THREE.Vector2,renderer:t.S.renderer,camera:t.S.camera},this.raycaster={raycaster:new THREE.Raycaster,start:new THREE.Vector2,renderer:t.S.renderer,camera:t.S.camera},this.entities={},this.add("light",o()),this.add("helper",i()),this.add("axisHelper",new THREE.AxisHelper(5e3)),this.add("earth",s()),this.add("rome",n(41.890251,12.492373)),document.addEventListener("mousemove",l.bind(this),!1)};h.prototype.add=function(t,e){this.entities[t]=e,this.getRoot().add(e)},h.prototype.get=function(t){return this.entities[t]},h.prototype.setSunPosition=function(t){if(this.get("light")){for(var e=new Date(t),r=c.dayOfTheYear(e),i=(r-91+365)%365,o=1800,n=[{limit:[0,91],angle:[0,o],id:"A"},{limit:[92,172],angle:[o,0],id:"B"},{limit:[173,266],angle:[0,-o],id:"C"},{limit:[266,365],angle:[-o,0],id:"D"}],s=0,a=0;a<n.length;a++){var p=n[a].limit,u=n[a].angle;if(i>=p[0]&&i<p[1]){s=c.interpolate(i+e.getHours()/24,p[0],p[1],u[0],u[1]),console.info(n[a].id,r,i,s.toFixed(0));break}}var h=15*-((t/36e5+6)%24),l=s;this.get("light").position.set(5e3*Math.sin(h*Math.PI/180),l,5e3*Math.cos(h*Math.PI/180)),this.get("light").lookAt(0,0,0)}},e.exports=u;var l=function(t){this.interceptor.mouse.x=t.clientX/this.interceptor.renderer.domElement.clientWidth*2-1,this.interceptor.mouse.y=2*-(t.clientY/this.interceptor.renderer.domElement.clientHeight)+1,this.interceptor.raycaster.setFromCamera(this.interceptor.mouse,this.interceptor.camera);var e=this.interceptor.raycaster.intersectObject(this.get("earth"));e.length>0?this.intersect={x:e[0].point.x,y:e[0].point.y,z:e[0].point.z,obj:e[0]}:this.intersect=void 0};THREE.ShaderTypes={phongDiffuse:{uniforms:{uDirLightPos:{type:"v3",value:new THREE.Vector3},uDirLightColor:{type:"c",value:new THREE.Color(16777215)},uMaterialColor:{type:"c",value:new THREE.Color(16777215)},uKd:{type:"f",value:.7},uBorder:{type:"f",value:.4}},vertexShader:["varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vNormal = normalize( normalMatrix * normal );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vViewPosition = -mvPosition.xyz;","}"].join("\n"),fragmentShader:["uniform vec3 uMaterialColor;","uniform vec3 uDirLightPos;","uniform vec3 uDirLightColor;","uniform float uKd;","uniform float uBorder;","varying vec3 vNormal;","varying vec3 vViewPosition;","void main() {","vec4 lDirection = viewMatrix * vec4( uDirLightPos, 0.0 );","vec3 lVector = normalize( lDirection.xyz );","vec3 normal = normalize( vNormal );","float diffuse = dot( normal, lVector );","if ( diffuse > 0.6 ) { diffuse = 1.0; }","else if ( diffuse > -0.2 ) { diffuse = 0.7; }","else { diffuse = 0.3; }","gl_FragColor = vec4( uKd * uMaterialColor * uDirLightColor * diffuse, 1.0 );","}"].join("\n")}}},{"../dep/ImprovedNoise":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\dep\\ImprovedNoise.js","../helper":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\helper.js","./factories/PlanetFactory":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\factories\\PlanetFactory.js"}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\factories\\MaterialFactory.js":[function(t,e,r){"use strict";var i=function(){};i.prototype.getTestMaterial=function(){return new THREE.MeshPhongMaterial({wireframe:!0})},i.prototype.getCloudsMaterial=function(t){var e=new THREE.MeshPhongMaterial({map:t,side:THREE.DoubleSide,opacity:.4,transparent:!0,depthWrite:!1});return e},e.exports=new i},{}],"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\factories\\PlanetFactory.js":[function(t,e,r){"use strict";var i=t("./MaterialFactory"),o={EARTH:{RADIUS:5e3,BASE_COLOR:554433,BASE_FOLDER:"images/EARTH/",BUMP_SCALE:50,CLOUDS:!0}},n=function(){};n.prototype.getPlanetGeometry=function(t){return new THREE.SphereGeometry(t.RADIUS,32,32)},n.prototype.getPlanetMaterial=function(t,e){var r=new THREE.MeshPhongMaterial;return r.map=THREE.ImageUtils.loadTexture(t.BASE_FOLDER+(e||"1k")+"/texture.jpg"),r.bumpMap=THREE.ImageUtils.loadTexture(t.BASE_FOLDER+(e||"1k")+"/bump.jpg"),r.bumpScale=t.BUMP_SCALE,r.specularMap=THREE.ImageUtils.loadTexture(t.BASE_FOLDER+(e||"1k")+"/specular.jpg"),r.specular=new THREE.Color("grey"),r},n.prototype.getPlanetMesh=function(t,e){var r=new THREE.Mesh(t,e);return r},n.prototype.getEarth=function(){return this.getPlanet("EARTH")},n.prototype.getPlanet=function(t){var e=this.getPlanetGeometry(o[t]),r=this.getPlanetMaterial(o[t],"4k"),n=this.getPlanetMesh(e,r);if(n.castShadow=!0,n.receiveShadow=!0,o[t].CLOUDS){var s=new THREE.SphereGeometry(o[t].RADIUS+180,32,32),a=i.getCloudsMaterial(THREE.ImageUtils.loadTexture(o[t].BASE_FOLDER+"clouds/clouds_t.jpg"));n.cloudsMesh=new THREE.Mesh(s,a),n.add(n.cloudsMesh)}return n},e.exports=new n},{"./MaterialFactory":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\modules\\factories\\MaterialFactory.js"}],"C:\\workspaces\\github\\cgen\\app\\scripts\\main.js":[function(t,e,r){"use strict";var i=t("./app/cgen");$(document).ready(function(){var t=new i({target:"three-canvas",userId:"oath01",userName:"gurbano"});t.hello().initHardware({}).initWorld({}).start()})},{"./app/cgen":"C:\\workspaces\\github\\cgen\\app\\scripts\\app\\cgen.js"}]},{},["C:\\workspaces\\github\\cgen\\app\\scripts\\main.js"]);